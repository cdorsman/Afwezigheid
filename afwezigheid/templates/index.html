{% extends "base.html" %}
{% block title %}Verlof{% endblock %}
{% block content %}
  <h1>Verlofaanvragen</h1>
  
  {% if current_user.is_authenticated and rol != "teamleider" %}
    <div class="authenticated-content">
      <p>Welkom, <strong>{{ current_user.gebruikersnaam }}</strong>
      <a style="margin-left: 10px;" href="{{ url_for('logout') }}">Afmelden</a></p>
      
      <section class="form-section">
        <h2>Verlofaanvraag indienen</h2>
        <form method="POST">
          {% if config.WTF_CSRF_ENABLED %}
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          {% endif %}
          <input type="hidden" name="action" value="request">
          
          <div>
            <label for="verlof_type">Verloftype:</label>
            <select id="verlof_type" name="verlof_type" required>
              <option value="">-- Selecteer --</option>
              <option value="Ziek">Ziek</option>
              <option value="Betaald">Betaald verlof</option>
              <option value="Onbetaald">Onbetaald verlof</option>
              <option value="Vakantie">Vakantie</option>
            </select>
          </div>
          
          <div>
            <label for="start_datum">Startdatum:</label>
            <input type="date" id="start_datum" name="start_datum" required>
          </div>
          
          <div>
            <label for="eind_datum">Einddatum:</label>
            <input type="date" id="eind_datum" name="eind_datum" required>
          </div>
          
          <button type="submit">Verlofaanvraag indienen</button>
        </form>
      </section>
      
      <section class="table-section">
        <h2>Uw verlofaanvragen</h2>
        {% if verlof %}
          <table>
            <thead>
              <tr>
                <th style="text-align: left">Type</th>
                <th style="text-align: left">Start</th>
                <th style="text-align: left">Eind</th>
                <th style="text-align: left">Status</th>
                <th style="text-align: left">Actie</th>
              </tr>
            </thead>
            <tbody>
              {% for record in verlof %}
                <tr>
                  <td style="padding-right: 20px;">{{ record.verlof_type }}</td>
                  <td style="padding-right: 20px;">{{ record.start_datum.strftime('%Y-%m-%d') }}</td>
                  <td style="padding-right: 20px;">{{ record.eind_datum.strftime('%Y-%m-%d') }}</td>
                  <td style="padding-right: 20px;">{{ record.status }}</td>
                  <td>
                    {% if record.status == 'In behandeling' %}
                      <form style="display: inline;" action="{{ url_for('index') }}" method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="verlof_id" value="{{ record.verlof_id }}">
                        <button type="submit">Verwijderen</button>
                      </form>
                    {% else %}
                      -
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>Geen verlofaanvragen gevonden.</p>
        {% endif %}
      </section>
    </div>
  
  {% elif current_user.is_authenticated and rol == "teamleider" %}
    <div class="teamleider-content">
      <p>Welkom teamleider, <strong>{{ current_user.gebruikersnaam }}</strong>
      <a style="margin-left: 10px;" href="{{ url_for('logout') }}">Afmelden</a></p>
      
      <section class="table-section">
        <h2>Verlofaanvragen ter goedkeuring</h2>
        {% if verlof %}
          <table>
            <thead>
              <tr>
                <th style="text-align: left">Werknemer ID</th>
                <th style="text-align: left">Type</th>
                <th style="text-align: left">Start</th>
                <th style="text-align: left">Eind</th>
                <th style="text-align: left">Status</th>
                <th style="text-align: left">Acties</th>
              </tr>
            </thead>
            <tbody>
              {% for record in verlof %}
                <tr>
                  <td style="padding-right: 20px;">{{ record.werknemer_id }}</td>
                  <td style="padding-right: 20px;">{{ record.verlof_type }}</td>
                  <td style="padding-right: 20px;">{{ record.start_datum.strftime('%Y-%m-%d') }}</td>
                  <td style="padding-right: 20px;">{{ record.eind_datum.strftime('%Y-%m-%d') }}</td>
                  <td style="padding-right: 20px;">{{ record.status }}</td>
                  <td>
                    <form style="display: inline;" action="{{ url_for('index') }}" method="POST">
                      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                      <input type="hidden" name="action" value="approve">
                      <input type="hidden" name="verlof_id" value="{{ record.verlof_id }}">
                      <button type="submit">Goedkeuren</button>
                    </form>
                    
                    <form style="display: inline;" action="{{ url_for('index') }}" method="POST">
                      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                      <input type="hidden" name="action" value="reject">
                      <input type="hidden" name="verlof_id" value="{{ record.verlof_id }}">
                      <button type="submit">Afkeuren</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>Geen verlofaanvragen ter goedkeuring.</p>
        {% endif %}
      </section>
    </div>
  
  {% else %}
    <div class="unauthenticated-content">
      <p>Welkom! U moet ingelogd zijn om verlofaanvragen in te dienen.</p>
      <p><a href="{{ url_for('login') }}">Klik hier om in te loggen</a></p>
    </div>
  {% endif %}
{% endblock %}